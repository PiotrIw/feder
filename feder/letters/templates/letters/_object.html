{% load i18n letters_tags %}
<div class="letter-body">
    {% if object.html_body %}
        <iframe srcdoc="{{ object.html_body|hide_email|escape }}"
                sandbox="allow-top-navigation">
        </iframe>
    {% else %}
        {{ object.body|hide_email|linebreaks }}
    {% endif %}
</div>

{% if object.quote or object.html_quote %}
    <blockquote class="expandable">
        {% if object.html_quote %}
            <iframe srcdoc="{{ object.html_quote|hide_email|escape }}"
                    class="letter-quote"
                    sandbox="allow-top-navigation">
            </iframe>
        {% else %}
            {{ object.quote|hide_email|linebreaks }}
        {% endif %}
    </blockquote>
{% endif %}

{% if object.note %}
    <div class="alert alert-warning mt-1">{{ object.note }}</div>
{% endif %}

{% if object.is_draft %}
    <div class="alert alert-warning mt-1">
        {% if object.is_mass_draft %}
            {% trans 'This is a mass message draft. The message has not been sent to any recipients yet.' %}
        {% else %}
            {% trans 'This is just a draft message. The message was not sent to the institution.' %}
        {% endif %}
    </div>
{% endif %}

{% if object.is_mass_draft %}
    <h4>{% trans "Recipient's tags" %}</h4>
    <ul>
        {% for tag in object.mass_draft.recipients_tags.all %}
            <li>{{ tag.name }}</li>
        {% endfor %}
    </ul>
{% endif %}

{% if object.attachment_set.all %}
    <div class="attachment-list">
        <h4>
            {% trans 'Attachments' %}
        </h4>
        <ul>
            <table class="table">
            {% for attachment in object.attachment_set.all %}
                <tr>
                    <td>
                        <li>
                            {{ attachment }}
                            {% if attachment.current_scan_request %}
                                ({% include 'virus_scan/_request.html' with object=attachment.current_scan_request %})
                                {% if not attachment.is_infected %}
                                    <a class="btn btn-xs btn-primary" href="{{ attachment.get_absolute_url }}">
                                        <i class="fa fa fa-download"></i>
                                        {% trans 'Download' %}
                                    </a>
                                {% endif %}
                            {% else %}
                                (nieskanowany)
                                <a class="btn btn-xs btn-default" href="{% url 'letters:scan' pk=attachment.pk letter_pk=object.pk %}">
                                    <i class="fa fa fa-eye"></i>
                                    {% trans 'Scan' %}
                                </a>
                            {% endif %}
                        </li>
                    </td>
                    <td>
                        {% if attachment.text_content %}
                        <blockquote class="expandable">
                            <p>{{ attachment.text_content|linebreaksbr }}</p>
                        </blockquote>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </table>    
        </ul>
    </div>
{% endif %}
