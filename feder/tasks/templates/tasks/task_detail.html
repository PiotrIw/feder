{% extends 'tasks/base.html' %}
{% load i18n %}
{% block breadcrumbs %}
<ol class="breadcrumb">
    <li><a href="{{object.case.monitoring.get_absolute_url}}">{{object.case.monitoring}}</a></li>
    <li><a href="{{object.case.get_absolute_url}}">{{object.case}}</a></li>
    <li class="active">{{object}}</li>
</ol>
{% endblock %}

{% block buttons %}
{% if object %}
{% include 'tasks/_btn.html' %}
{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fa fa-folder-edit"></i> {{object}}</h1>
</div>

<div class="col-sm-5">
    <div class="red">
        <p>
            <i class="fa fa-folder-open"></i>
            {% trans "Case"%}:
            <a href="{{object.case.get_absolute_url}}">{{object.case}}</a>
        </p>
        <p>
            <i class="fa fa-list-alt"></i>
            {% trans "Questionary"%}:
            <a href="{{object.questionary.get_absolute_url}}">{{object.questionary}}</a>
        </p>
        {% include 'cases/_desc.html' with object=object.case %}
    </div>

    {% if user_survey %}
        <div class="gray">
            <h2>{% trans 'Your analysis' %}</h2>
            {% include 'tasks/_answer.html' with object_list=user_survey.answer_set.all %}
            <a href="{% url 'tasks:delete_survey' task_id=object.pk %}" class="btn btn-default">
                {% trans 'Delete' %}
            </a>
        </div>
    {% else %}
        <div class="gray">
            <h2>{% trans 'To do' %}</h2>
            {# TODO: Cache it per-questionary #}
            {% include 'tasks/_formset.html' with object=formset %}
        </div>
    {% endif %}

</div>

<div class="col-sm-7">
    {% if object.case.letter_set.for_milestone.all %}
    {% include 'letter/_milestone_list.html' with object_list=object.case.letter_set.for_milestone.all %}
    {% else %}
    {% trans 'No rows.' %}
    {% endif %}
</div>
{% endblock %}

{% comment %}
{% if object.survey_set.all %}
<div class="gray">
    <h3>{% trans 'Surveys' %}</h3>
    <table class="table table-stripped">
        {% for survey in object.survey_set.all %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>
                {{survey}} - <a href="{{survey.user.get_absolute_url}}">{{survey.user}}</a>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            {% trans 'Answers' %}
                        </h3>
                    </div>
                    <table class="table table-stripped">
                        {% for answer in survey.answer_set.all %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{answer}}<pre>{{answer.blob}}</pre></td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endif %}
{% endcomment %}
